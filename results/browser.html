<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Result Browser</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<script language="JavaScript">

var result_prefix = '';
var runs;
var meta;
var i = 0;

function load_results( benchmark ) {

    var url = result_prefix + benchmark;
    console.log(url);
    $.getJSON(url, function(data) {

        $.each(data, function(key, val) {

            if (key == 'runs') {
                runs = val;
            } else if (key == 'meta') {
                meta = val;
            } else {
                console.log('Unknown key: ['+key+']');
            }

        });
        render(this, i );

    });
}

function avg( floats ) {

    var avg_i;
    var avg_t = 0.0;
    for(avg_i=0; avg_i<floats.length; avg_i++) {
        avg_t += floats[avg_i];
    }
    return (avg_t / floats.length).toFixed(4);

}

function render( e, run )  {

    var bm      = runs[run][0];
    var alias   = runs[run][1];
    var engine  = runs[run][2];
    var env     = runs[run][3];
    var args_str= runs[run][4];
    var times   = runs[run][5]; 
    var avg_time= avg( times );
    var perfs   = runs[run][6];

    $('#result').html($(
        '<p/>', {html: bm +' '+ alias +' '+ engine +' '+ avg_time}
    ));

    var items = [];

    $.each(perfs, function(key, val) {
        items.push('<li id="perf_' + key + '"><pre>' + val + '</pre></li>');
    });

    $('#nav').html((i+1)+'/'+runs.length);
    $('<ul/>', {
        'class': 'my-new-list',
        html: items.join('')
    }).appendTo('#result');
}
</script>
</head>
<body>

<a id="reload" href="#" style="display: inline;">Load</a>
<input id="benchmark" type="text" value="akira/benchmark-latest.json" />
<a id="prev" href="#" style="display: inline;" >Prev</a>
<div id="nav"  style="display: inline;"></div>
<a id="next" href="#" style="display: inline;">Next</a>

<div id="result">
This script probably only works in Firefox.
</div>
<script language="JavaScript">
    load_results($('#benchmark').val());

    $('#reload').bind('click', function(e) {
        load_results($('#benchmark').val());
    });

    $('#prev').bind('click', function(e) {
        i = (i<1) ? 0 : i-1;
        render(e, i);
    });
    $('#next').bind('click', function(e) {
        i = (i>(runs.length-1)) ? runs.length-1: i+1;
        render(e, i);
    });
    
</script>
</body>
