<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Result Browser</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<script language="JavaScript">

var result_prefix = '';
var runs;
var meta;
var i = 0;

var times       = [];
var times_avg   = 0.0;
var times_i     = 0;
var perfs = [];
var banner = '';

function load_results( benchmark ) {

    var url = result_prefix + benchmark;

    i = 0;
    times = [];
    times_avg = 0.0;
    times_i     = 0;
    perfs = [];
    banner = '';

    $.getJSON(url, function(data) {

        $.each(data, function(key, val) {

            if (key == 'runs') {
                runs = val;
            } else if (key == 'meta') {
                meta = val;
            } else {
                console.log('Unknown key: ['+key+']');
            }

        });

        banner = 'Results from "'+meta["hostname"] +'" running "'+ meta["suite"] +'" rev "'+ meta["rev"]+'".';
        render(this, i );

    });
}

function avg( floats ) {

    var avg_i;
    var avg_t = 0.0;
    for(avg_i=0; avg_i<floats.length; avg_i++) {
        avg_t += floats[avg_i];
    }
    return (avg_t / floats.length).toFixed(4);

}

function render( e, run )  {

    var bm      = runs[run][0];
    var alias   = runs[run][1];
    var engine  = runs[run][2];
    var env     = runs[run][3];
    var args_str= runs[run][4];

    times       = runs[run][5]; 
    times_avg   = avg( times );
    perfs       = runs[run][6];

    $('#meta').html($('<p/>', {html: banner}));
    $('#page').html('Run '+(i+1)+'/'+runs.length);
    $('#result').html($(
        '<p/>', {html: '<b>'+bm+'</b>' +' - '+ alias +' - '+ engine +' '+ times_avg+' seconds<br />'+args_str}
    ));

    $('<pre/>', {
        'class': 'perf',
        html: perfs[times_i]
    }).appendTo('#result');
    $('.perf').html(1+times_i+ '/'+ times.length+' - Elapsed '+ times[times_i] + perfs[times_i]);

}

function prev(e) {
    i = (i<1) ? 0 : i-1;
    render(e, i);
}

function next(e) {
    i = (i<(runs.length-1)) ? i+1: runs.length-1;
    render(e, i);
}

function up(e) {
    times_i = (times_i<1) ? 0 : times_i-1;
    $('.perf').html(1+times_i+ '/'+ times.length+' - Elapsed '+ times[times_i] + perfs[times_i]);
}

function down(e) {
    times_i = (times_i<(times.length-1)) ? times_i+1: times.length-1;
    $('.perf').html(perfs[times_i]);
    $('.perf').html(1+times_i+ '/'+ times.length+' - Elapsed '+ times[times_i] + perfs[times_i]);
}

</script>
</head>
<body>

<form>
<input id="benchmark" type="text" value="akira/benchmark-latest.json" size="50"/>
<input id="reload" type="submit" action="return false;" value="Load">
</form>

<div id="meta"></div>

<div id="nav" style="display: inline;">
<a id="prev" href="#" style="display: inline;" >Prev</a>
<div id="page"  style="display: inline;"></div>
<a id="next" href="#" style="display: inline;">Next</a>
</div>

<div id="result">
This script probably only works in Firefox.
</div>
<script language="JavaScript">
    load_results($('#benchmark').val());

    $('#reload').bind('click', function(e) {
        load_results($('#benchmark').val());
    });

    $('#prev').bind('click', function(e) {
        prev(e);
    });
    $('#next').bind('click', function(e) {
        next(e);
    });

    $(document).keydown(function (e) {
        var keyCode = e.keyCode || e.which, arrow = {left: 37, up: 38, right: 39, down: 40 };

        switch (keyCode) {
        case arrow.left:
            prev(e);
        break;
        case arrow.right:
            next(e);
        break;

        case arrow.up:
            up(e);
        break;
        case arrow.down:
            down(e);
        break;
        }
    });
    
</script>
</body>
